#!/usr/bin/env bash

echo -e "Clickhouse (type $suffix):"
if [[ -L clickhouse/data$suffix/data/default/$test ]] || [[ -e clickhouse/data$suffix/data/default/$test ]]; then
  echo -e "${COLORED}\tNo need to rebuild${NC}"
  exit 10
fi

docker-compose -f ../../docker-compose.yml --env-file ../../.env stop clickhouse
docker-compose -f ../../docker-compose.yml --env-file ../../.env rm -f clickhouse

cmd="test=$test suffix=$suffix docker-compose -f ../../docker-compose.yml --env-file ../../.env up -d clickhouse"
echo -e "\tStarting clickhouse ($cmd)"
eval "$cmd"
while ! nc -z localhost 9000; do sleep 1; done
sleep 5
docker exec clickhouse_engine clickhouse-client --query="DROP TABLE IF EXISTS default.$test"
